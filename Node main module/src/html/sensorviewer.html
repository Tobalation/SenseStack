<!DOCTYPE HTML>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css"
        integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
    <style>
        html {
            font-family: Arial;
            display: inline-block;
            margin: 0px auto;
            text-align: center;
        }

        h2 {
            font-size: 3.0rem;
        }

        p {
            font-size: 3.0rem;
        }

        .units {
            font-size: 1.2rem;
        }

        .sensor-label {
            font-size: 1.5rem;
            vertical-align: middle;
            padding-bottom: 15px;
        }
    </style>
</head>

<body>
    <h2>Live connected sensor viewer</h2>
    <div id=sensorElement>
        <p>Getting sensor information...</p>
    </div>
</body>

<footer>
    <p style="padding-top:15px;text-align:center">
        <a href="/_ac"><img
                src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAApklEQVRYR2NkGGDAOMD2M4w6YDQEkEMgEJggZwCxGI0T5mug+alAvBFkD7IDXtLBcpjfXgEZ4ugOeAETpHEIgIwHeVYC3QH+0CgAS9AQgCwHRcFmdAfQ0E7cRo9mw0EVAqPlAKhwEKVTVsBZDsyiQ2k4Wg6gxPKgyoZ0Sn+o1iCHQBBQaiYQi9DYJTjbAyAJWluOtz0wWg7QOOqxGz+aDUdDYMBDAACA0x4hs/MPrwAAAABJRU5ErkJggg==" border="0" title="AutoConnect menu" alt="AutoConnect menu" />
            </a>
    </p>

</footer>


<script>

    loadData();                  //Load the data for first time
    setInterval(loadData, 1000); //Reload the data every X milliseconds.

    //Load the JSON data from API, and then replace the HTML element
    function loadData(){
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {

                var sensorElement = document.getElementById("sensorElement");

                sensorElement.textContent = "";     //Clear all elements in sensorElement div

            
                var sensorsData = JSON.parse(this.response).data;     //Parse the response to JSON object
                

                if (Object.keys(sensorsData).length == 0 ) {                          //object is empty
                    sensorElement.innerHTML = "<p> No sensors connected. </p>"
                    return;
                }

                for (sensorName of Object.keys(sensorsData)) {                        //iterate through each element and create paragraph for each sensor 
                    sensorElement.innerHTML += "<p><span class=\"sensor-label\">" +
                        sensorName + "</span> <span id=\"sensor-value\">" +
                        sensorsData[sensorName] + " </span> <sup class=\"units\">" + ' ' + " </sup>  </p>";

                }

            }
        };


        xhttp.open("GET", "/getJSON", true);      //request JSON data from URI/getJSON
        xhttp.send();
    }

</script>
</html>
